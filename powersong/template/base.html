{% with "Strava Power Song" as APPTITLE %}
<!doctype html>
<html>
    <head>
        <meta charset="utf-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
        <meta name="viewport" content="width=device-width, minimum-scale=1.0 minimal-ui"/>
        <meta name="description" content=""/>
        <meta name="author" content=""/>

        {% load staticfiles %}
        <link rel="shortcut icon" href="{% static "favicon.ico" %}" />

        <title>{{ APPTITLE }}</title>
        
        {% block head %}{% endblock %}
    </head>
    <body>

    <nav class="navbar fixed-top navbar-inverse navbar-toggleable-sm bg-inverse justify-content-center">
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#collapsingNavbar3">
            <span class="navbar-toggler-icon"></span>
        </button>
        <a href="/" class="navbar-brand d-flex w-10 mr-auto">Power Song</a>
        <div class="navbar-collapse collapse" id="collapsingNavbar3">
            <ul class="navbar-nav mx-auto w-10 justify-content-center">

            </ul>
            <ul class="nav navbar-nav ml-auto w-100 justify-content-end">

                <li class="nav-item"> <div id="progress"></div> </li>

                <li class="nav-item"> <a class="btn-margin-left" href="https://www.strava.com/athletes/{{ athlete.athlete_id }}"><img src="{{ athlete.profile_image_url }}" width="40" height="40" class="rounded-circle" alt="Strava profile picture"></a> </li>
                <li class="nav-item"> <a class="nav-link">{{ athlete.runs_count }} runs</a> </li>
                <li class="nav-item"> <a class="nav-link">{{ athlete.rides_count }} rides</a> </li>
                <li class="nav-item"> <a class="btn-margin-left" href="http://www.last.fm/user/{{ listener.nickname }}"><img src="{{ listener.profile_image_url }}" class="rounded-circle" width="40" height="40"  alt="last.fm profile picture"></a> </li>
                <li class="nav-item"> <a class="nav-link">{{ listener.scrobble_count }} scrobbles</a> </li>

                <li class="nav-item"> <a class="btn btn-margin-left btn-outline-success " href="javascript:void(0)" onclick="progress() " role="button">Update</a> </li>
                <li class="nav-item"> <a class="btn btn-margin-left btn-outline-info " href="javascript:void(0)" onclick="sync()" role="button">Sync</a> </li>
                <li class="nav-item"> <a class="btn btn-margin-left btn-outline-danger" href="/logout" role="button">Logout</a> </li>
            </ul>
        </div>
    </nav>

    

        {% block content %}{% endblock %}  
      <hr>
    <div class="container">
      <footer>
        <p>&copy; André Mourão 2017</p>
      </footer>
    </div> <!-- /container -->

     <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

    <script src="https://code.jquery.com/jquery-3.1.1.min.js" crossorigin="anonymous"></script>

    <script type="text/javascript">

    function img_error(image) {
        image.onerror = "";
        image.src = '/static/nopicture.png';
     return true;
    }

    function load_async(div,url) {
        $(div).html('<img src="/static/spinner.gif" width="40" height="40">');
        $(div).load(url)
    }

    function update_all() {

        load_async('#progress','/get_sync_progress/')
        load_async('#top','/top/?type=top&field=avg_speed&dispfield=avg_speed_s&activity_type={{ athlete_type }}')
        load_async('#top-hr','/top/?type=top&field=avg_hr&dispfield=avg_hr&activity_type={{ athlete_type }}')
        load_async('#avg','/top/?type=avg&field=avg_speed&dispfield=avg_speed_s&activity_type={{ athlete_type }}&min_count=5')
        load_async('#artists','/artists?activity_type={{ athlete_type }}')
        load_async('#songs','/songs?activity_type={{ athlete_type }}')

    }

    function sync() {
        load_async('#progress','/sync/')
    }

    function progress() {
        load_async('#progress','/get_sync_progress/')
    }



    </script>



    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link href="/static/app.css" rel="stylesheet">
    </body>

    {% block extra_js %}{% endblock %}
</html>
{% endwith %}